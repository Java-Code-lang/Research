<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Goal Tracker: Sep 1 - Sep 30</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-6">
    
    <!-- Title -->
    <h1 class="text-4xl font-bold text-center text-blue-600 mb-2">Goal Tracker: Sep 1 - Sep 30</h1>
    <p class="text-center text-gray-500 mb-6">Track daily goals, compare expectation vs reality, and view summary progress.</p>
    
    <!-- Option Selection -->
    <div class="bg-white shadow rounded-lg p-4 mb-6 flex flex-wrap gap-4 items-center justify-between">
      <div>
        <label class="font-semibold mr-3">Choose Option:</label>
        <input type="radio" name="option" value="1" id="opt1" class="mr-1"> <label for="opt1">Business Focus</label>
        <input type="radio" name="option" value="2" id="opt2" class="ml-4 mr-1"> <label for="opt2">Job Search Focus</label>
      </div>
      <div>
        <input type="checkbox" id="allowStorage" checked class="mr-1"><label for="allowStorage">Allow Local Storage</label>
      </div>
    </div>
    
    <!-- Day & Task Input -->
    <div class="bg-white shadow rounded-lg p-4 mb-6">
      <label class="font-semibold block mb-2">Select Day:</label>
      <select id="daySelect" class="border rounded px-3 py-2 mb-4 w-full max-w-xs"></select>
      <div id="tasks" class="mb-4"></div>
      <button id="saveBtn" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700">Save Data</button>
    </div>

    <!-- Summary Dashboard -->
    <div class="bg-white shadow rounded-lg p-6 mb-6">
      <h2 class="text-2xl font-bold mb-4 text-gray-700">Summary Dashboard</h2>
      <div id="summaryCards" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
      <canvas id="summaryChart" class="mt-6"></canvas>
    </div>

    <!-- Daily Report -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-2xl font-bold mb-4 text-gray-700">Daily Report</h2>
      <div id="report"></div>
    </div>

  </div>

  <script>
    const options = {
      1: { tasks: ['Stockmarket study', 'AI or skills', 'Business', 'UAE job visa'], times: [0.5, 3, 5, 1] },
      2: { tasks: ['Stockmarket study', 'AI or skills', 'Job search and confirmed got', 'UAE job visa'], times: [0.5, 3, 5, 1] }
    };

    let data = { option: 1, days: {} };
    const STORAGE_KEY = 'goalTrackerSep2025';

    function loadData() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) data = JSON.parse(stored);
    }
    function saveData() {
      if (document.getElementById('allowStorage').checked) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }
    }

    // Populate day select
    const daySelect = document.getElementById('daySelect');
    for (let i = 1; i <= 30; i++) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = `Day ${i} (Sep ${i})`;
      daySelect.appendChild(opt);
    }

    // Load initial data
    loadData();
    document.getElementById(`opt${data.option}`).checked = true;

    // Event listeners
    document.querySelectorAll('input[name="option"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        data.option = parseInt(e.target.value);
        saveData();
        showTasks();
        updateSummary();
      });
    });

    daySelect.addEventListener('change', showTasks);

    document.getElementById('saveBtn').addEventListener('click', () => {
      const day = daySelect.value;
      if (!day) { alert('Please select a day.'); return; }
      const actuals = [];
      for (let i = 0; ; i++) {
        const inp = document.getElementById(`task${i}`);
        if (!inp) break;
        actuals.push(parseFloat(inp.value) || 0);
      }
      data.days[day] = actuals;
      saveData();
      showReport(day);
      updateSummary();
    });

    function showTasks() {
      const opt = data.option;
      const day = daySelect.value;
      if (!day) return;
      const tasksDiv = document.getElementById('tasks');
      tasksDiv.innerHTML = '<h3 class="font-semibold mb-2">Enter Actual Hours Spent:</h3>';
      const tasks = options[opt].tasks;
      const times = options[opt].times;
      const actuals = data.days[day] || times.map(() => 0);

      for (let i = 0; i < tasks.length; i++) {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-3 mb-2';
        div.innerHTML = `<label class="w-64">${tasks[i]} (Expected: ${times[i]} hrs)</label>
                         <input type="number" step="0.1" min="0" value="${actuals[i]}" id="task${i}" class="border rounded px-2 py-1 w-24">`;
        tasksDiv.appendChild(div);
      }
      showReport(day);
    }

    function showReport(day) {
      const opt = data.option;
      const times = options[opt].times;
      const tasks = options[opt].tasks;
      const actuals = data.days[day] || times.map(() => 0);
      const reportDiv = document.getElementById('report');
      reportDiv.innerHTML = `<h3 class="font-semibold mb-3">Expectation vs Reality for Day ${day} (Sep ${day})</h3>`;

      let html = `<table class="w-full border-collapse">
                  <thead><tr class="bg-gray-100 text-left">
                  <th class="p-2">Task</th><th class="p-2">Expected</th><th class="p-2">Actual</th><th class="p-2">Progress</th></tr></thead><tbody>`;
      let totalExp = 0, totalAct = 0;
      for (let i = 0; i < tasks.length; i++) {
        const exp = times[i], act = actuals[i];
        totalExp += exp; totalAct += act;
        const percent = exp > 0 ? (act / exp * 100).toFixed(1) : 0;
        const color = percent < 50 ? 'bg-red-500' : percent < 80 ? 'bg-yellow-500' : 'bg-green-500';
        html += `<tr class="border-t"><td class="p-2">${tasks[i]}</td><td class="p-2">${exp}</td><td class="p-2">${act}</td>
                 <td class="p-2"><div class="h-4 ${color} text-white text-xs text-center rounded" style="width:${Math.min(percent,100)}%">${percent}%</div></td></tr>`;
      }
      const totalPercent = totalExp > 0 ? (totalAct / totalExp * 100).toFixed(1) : 0;
      const totalColor = totalPercent < 50 ? 'bg-red-500' : totalPercent < 80 ? 'bg-yellow-500' : 'bg-green-500';
      html += `<tr class="font-bold border-t"><td class="p-2">Total</td><td class="p-2">${totalExp}</td><td class="p-2">${totalAct}</td>
               <td class="p-2"><div class="h-4 ${totalColor} text-white text-xs text-center rounded" style="width:${Math.min(totalPercent,100)}%">${totalPercent}%</div></td></tr>`;
      html += '</tbody></table>';
      reportDiv.innerHTML += html;
    }

    function updateSummary() {
      const opt = data.option;
      const times = options[opt].times;
      let totalExp = 0, totalAct = 0;
      const expTotals = [], actTotals = [];

      for (let d = 1; d <= 30; d++) {
        const actuals = data.days[d] || times.map(() => 0);
        const expDay = times.reduce((a, b) => a + b, 0);
        const actDay = actuals.reduce((a, b) => a + b, 0);
        expTotals.push(expDay);
        actTotals.push(actDay);
        totalExp += expDay;
        totalAct += actDay;
      }

      const avgPercent = totalExp > 0 ? (totalAct / totalExp * 100).toFixed(1) : 0;

      // Cards
      document.getElementById('summaryCards').innerHTML = `
        <div class="p-4 bg-blue-100 rounded shadow text-center">
          <h3 class="text-lg font-bold">Total Expected</h3><p class="text-2xl">${totalExp} hrs</p>
        </div>
        <div class="p-4 bg-green-100 rounded shadow text-center">
          <h3 class="text-lg font-bold">Total Actual</h3><p class="text-2xl">${totalAct} hrs</p>
        </div>
        <div class="p-4 bg-yellow-100 rounded shadow text-center">
          <h3 class="text-lg font-bold">Average Progress</h3><p class="text-2xl">${avgPercent}%</p>
        </div>`;

      // Chart
      const ctx = document.getElementById('summaryChart').getContext('2d');
      if (window.summaryChart) window.summaryChart.destroy();
      window.summaryChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 30}, (_, i) => `Sep ${i+1}`),
          datasets: [
            { label: 'Expected Hours', data: expTotals, borderColor: '#1a73e8', fill: false },
            { label: 'Actual Hours', data: actTotals, borderColor: '#34c759', fill: false }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
      });
    }

    // Init
    if (daySelect.value) showTasks();
    updateSummary();
  </script>
</body>
</html>
